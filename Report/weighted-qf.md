## Weighted Quick-Find
### 2018月8月7日

- 頂点$u$から$v$に行くまでのコストはいくらか？（または行けないか？）
- 頂点$u$から$v$にコスト$w$の辺を張る
  - $v$から$u$へはコスト$-w$で結ばれる
    - 「重みつき」ではなく「ポテンシャルつき」とするのがよいとする立場がある
    - 私も賛成しそう

というクエリに答えるデータ構造で，Quick-findに基づく．
Quick-findの説明は上にあるので省く．

各グループ$j$には（陽には持たない）超頂点$v_j$が繋がっているとする．
頂点$i$がグループ$j$に属するとき，$v_j$から$i$へのコストを別の配列の要素$w_i$に持っておく．

`unite`$(u, v, w)$を考える．
$G(u)$，$G(v)$をそれぞれ$g_u$，$g_v$とする．
このとき，$g_u$から$g_v$へコスト$x$の辺を張ると考えることができる．
&\[\mathrm{Cost}(u\to g_u)+x+\mathrm{Cost}(g_v\to v) = w\]&
なので，
&\[-w_u+x+w_v = w\]&
となり，$x=w+w_u-w_v$とわかる[^wqf_sign]．
#[^wqf_sign]: $w$の要素が超頂点と頂点のどちらの向きのコストなのか？ とか，$u$と$v$のどちらからどちらに辺を張るか？ とかによって符号は変わるので，実装に合わせて適宜変えてよい．
$g_v$に属する各頂点にとって，超頂点からのコストが$x$増えるので，対応付けを変えるのと同時に更新する．